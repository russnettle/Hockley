<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hockley Planning Objection Helper</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      max-width: 700px;
    }
    label, input, textarea {
      display: block;
      margin-top: 1rem;
    }
    fieldset {
      margin-top: 2rem;
      padding: 1rem;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 1.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
    }
    #mailto-link {
      display: inline-block;
      margin-top: 1rem;
      font-weight: bold;
      text-decoration: none;
      color: #0645AD;
    }
  </style>
</head>
<body>

  <h1>Object to Planning Application 25/00106/EIA</h1>
  <p>
    Hockley is facing another large development proposal. Many residents are concerned, but may not find the time to write an objection email.
    Use this simple form to generate a tailored email based on the concerns you wish to raise.
  </p>

  <form id="objection-form">
    <label for="name">Your Name:</label>
    <input type="text" id="name" required>

    <label for="postcode">Your Address/Postcode:</label>
    <input type="text" id="postcode" required>

    <fieldset>
      <legend>Select your key concerns:</legend>
      <label><input type="checkbox" name="concern" value="traffic"> Traffic congestion / 'Blockley' gridlock</label>
      <label><input type="checkbox" name="concern" value="doctors"> Overstretched local doctors surgeries</label>
      <label><input type="checkbox" name="concern" value="schools"> Overcrowded schools</label>
      <label><input type="checkbox" name="concern" value="pollution"> Air pollution and environmental impact</label>
      <label><input type="checkbox" name="concern" value="infrastructure"> Lack of supporting infrastructure</label>
    </fieldset>

    <button type="submit">Generate Email</button>
  </form>

  <div id="email-output" style="margin-top:2rem; display:none;">
    <h2>Suggested Email</h2>
    <textarea id="email-text" rows="12" style="width:100%;"></textarea>

    <p>
      <a id="mailto-link" href="#" target="_blank">
        ðŸ“§ Click here to open your email app and send
      </a>
    </p>
  </div>

  <script>
    document.getElementById('objection-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const name = document.getElementById('name').value.trim();
      const postcode = document.getElementById('postcode').value.trim();
      const concerns = Array.from(document.querySelectorAll('input[name="concern"]:checked')).map(cb => cb.value);

      // Create a formatted string based on selected concerns
      let points = "";
      if (concerns.includes("traffic")) points += "- The area already suffers from serious traffic congestion and was recently nicknamed 'Blockley' due to constant gridlock.\n";
      if (concerns.includes("doctors")) points += "- Local GP surgeries are overstretched, and additional housing will worsen access to care.\n";
      if (concerns.includes("schools")) points += "- Schools in the area are already full, and new developments will overwhelm them.\n";
      if (concerns.includes("pollution")) points += "- Pollution levels are already moderate and may worsen due to construction and traffic.\n";
      if (concerns.includes("infrastructure")) points += "- There is a lack of infrastructure to support the proposed expansion, from public transport to utilities.\n";

      const email = `Dear Councillor,\n\nI am writing to formally object to the proposed planning application in Hockley.\n\nAs a resident living in ${postcode}, I have serious concerns about the impact this development will have on our community:\n\n${points}\nI urge you to consider these impacts and reject the application.\n\nYours sincerely,\n${name}`;

      // Now send this data to the backend to generate a response using fetch
      try {
        const response = await fetch('https://v0-new-project-gvk70ardgcd-git-main-russ-freemans-projects.vercel.app/api/gemini', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            emailData: { text: email }
          })
        });

        const result = await response.json();

        // Assuming result contains the generated email response, you can update the email textarea
        document.getElementById('email-output').style.display = 'block';
        document.getElementById('email-text').value = result.generatedEmail; // Assuming this is the response field

        // Set up the mailto link
        const subject = encodeURIComponent("Objection to Planning Application 25/00106/EIA - Mount Bovers");
        const body = encodeURIComponent(result.generatedEmail); // Use the generated email content
        const mailto = `mailto:CllrMike.Steptoe@rochford.gov.uk,CllrArthur.Williams@rochford.gov.uk,CllrAngelina.Marriott@rochford.gov.uk?subject=${subject}&body=${body}`;

        document.getElementById('mailto-link').href = mailto;
      } catch (error) {
        console.error('Error generating email:', error);
        alert('There was an error generating the email.');
      }
    });
  </script>

</body>
</html>
